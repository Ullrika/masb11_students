<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="sv" xml:lang="sv"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Skriv ditt namn här">

<title>Centrala Gränsvärdessatsen (CGS)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lab2_student_rapport_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lab2_student_rapport_files/libs/quarto-html/quarto.js"></script>
<script src="Lab2_student_rapport_files/libs/quarto-html/popper.min.js"></script>
<script src="Lab2_student_rapport_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lab2_student_rapport_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lab2_student_rapport_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lab2_student_rapport_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lab2_student_rapport_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lab2_student_rapport_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lab2_student_rapport_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innehållsförteckning</h2>
   
  <ul>
  <li><a href="#förberedelseuppgifter" id="toc-förberedelseuppgifter" class="nav-link active" data-scroll-target="#förberedelseuppgifter">Förberedelseuppgifter</a></li>
  <li><a href="#centrala-gränsvärdessatsen" id="toc-centrala-gränsvärdessatsen" class="nav-link" data-scroll-target="#centrala-gränsvärdessatsen"><span class="header-section-number">1</span> Centrala gränsvärdessatsen</a></li>
  <li><a href="#cgs-i-praktiken" id="toc-cgs-i-praktiken" class="nav-link" data-scroll-target="#cgs-i-praktiken"><span class="header-section-number">2</span> CGS i praktiken</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Andra format</h2><ul><li><a href="Lab2_student_rapport.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="Lab2_student_rapport.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Centrala Gränsvärdessatsen (CGS)</h1>
<p class="subtitle lead">Datorlaboration 2</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Författare</div>
  <div class="quarto-title-meta-heading">Tillhörighet</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Skriv ditt namn här </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Lunds Universitet
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Publicerad</div>
    <div class="quarto-title-meta-contents">
      <p class="date">14 mars 2024</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstrakt</div>
    <p>Syftet med dagens laboration är att du ska:</p>
    <ul>
    <li>illustrera centrala gränsvärdessatsen (CGS) med hjälp av simulering</li>
    <li>använda CGS i en praktisk situation</li>
    <li>arbeta med kursens Miniprojekt I</li>
    </ul>
  </div>
</div>

</header>

<section id="förberedelseuppgifter" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="förberedelseuppgifter">Förberedelseuppgifter</h2>
<p>Repetera begreppen <em>normalfördelning, väntevärde och varians för en summa (eller medelvärde) av oberoende slumpvariabler</em>.</p>
<p>Du skall ha gjort följande uppgifter <strong>innan</strong> du kommer till laborationen.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hemuppgift 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gör <strong>Dig:3.3.2_5</strong> och <strong>3.96</strong> och <strong>Dig:3.4.5_1</strong> på övning 5.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hemuppgift 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Försök att med egna ord beskriva vad centrala gränsvärdessatsen säger.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hemuppgift 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Repetera vad du gjorde vid laboration 1 och vilka metoder du använder för att simulera slumptal och för att anpassa en fördelning till data.</p>
</div>
</div>
</section>
<section id="centrala-gränsvärdessatsen" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Centrala gränsvärdessatsen</h1>
<blockquote class="blockquote">
<p>Adderar man (eller beräknar medelvärdet) av flera oberoende normalfördelade slumpvariabler är summan också normalfördelad. Men vad händer om man lägger ihop flera variabler som alla är rektangelfördelade? Vilken fördelning fås om man adderar exponentialfördelade variabler?</p>
<p>Centrala gränsvärdessatsen (CGS) säger att om man adderar ett stort antal oberoende variabler från en godtycklig fördelning blir summan (eller medelvärdet) normalfördelad. I formler: om <span class="math inline">\(n\)</span> är tillräckligt stort gäller att <span class="math inline">\(Z_n = X_1 + X_2 + \ldots + X_n\)</span> är approximativt normalfördelad oavsett vilket fördelning <span class="math inline">\(X_1, \ldots, Xn\)</span> har. Med några simuleringar ska du undersöka om detta tycks stämma, där vi utgår från några olika fördelningar för <span class="math inline">\(X\)</span>-variablerna.</p>
</blockquote>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 1.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Simulera 1000 slumptal från en rektangelfördelning, <span class="math inline">\(R(0, 1)\)</span> och lägg dem i variabeln <code>unif1</code>. Använd <code>hist()</code> och <code>qqnorm()</code> för att konstatera att slumptalen är rektangelfördelade och definitivt inte passar till en normalfördelning.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>unif1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 1.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Simulera 1000 nya slumptal från en rektangelfördelning, <span class="math inline">\(R(0, 1)\)</span> och lägg dem i variabeln <code>unif2</code>. Summera sedan de gamla och de nya slumptalen genom <code>sum12 &lt;- unif1+unif2</code>. Resultatet är 1000 slumptal från <span class="math inline">\(Z_2 = X_1 + X_2\)</span>. Använd <code>hist()</code> och <code>qqnorm()</code> för att undersöka fördelningen hos denna summa</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 1.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Skapa även variabler <code>unif3</code>, <code>unif4</code> och <code>unif5</code> på motsvarande sätt och studera fördelningen för <span class="math inline">\(X_1+X_2+\ldots+X_5\)</span>. Verkar det rimligt att ju större <span class="math inline">\(n\)</span> är, desto bättre kan fördelningen för summan anpassas till en normalfördelning?</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 1.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Skapa även variabler <code>unif3</code>, <code>unif4</code> och <code>unif5</code> på motsvarande sätt och studera fördelningen för <span class="math inline">\(X_1+X_2+\ldots+X_5\)</span>. Verkar det rimligt att ju större <span class="math inline">\(n\)</span> är, desto bättre kan fördelningen för summan anpassas till en normalfördelning?</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 1.5
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pröva vad som händer då du summerar exponentialfördelade slumvariabler med väntevärde 1 (<code>rexp(1000,1)</code>). Hur många variabler behövs summeras innan summan kan approximeras med en normalfördelning?</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
</section>
<section id="cgs-i-praktiken" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> CGS i praktiken</h1>
<blockquote class="blockquote">
<p>På 35 patienter med Hodgkins sjukdom mätte man antalet T4 celler i blodet (antal/mm3). Samtidigt mätte man motsvarande antal hos 35 patienter som hade andra sjukdomar (Non-Hodgkins). Data ligger i filen <code>data/lab2_mini1_filer/Hodgkindata.RData</code>. Läs in data med <code>load()</code>. Du har nu fått två nya variabler Hodgkin och NonHodgkin.</p>
</blockquote>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/lab2_mini1_filer/Hodgkindata.RData"</span>)</span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 2.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Undersök om antalet celler i blodet är normalfördelat för de båda grupperna.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 2.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Det kan vara intressant att jämföra grupperna genom att bilda differensen mellan de två gruppmedelvärdena. Använd dig av centrala gränsvärdessatsen för att säga något om vilken fördelning differensen i stickprovsmedelvärden har.</p>
</div>
</div>
<p><strong>Modell</strong>:</p>
<p>Låt <span class="math inline">\(\mu_{Hodgkin}\)</span> och <span class="math inline">\(\mu_{NonHodgkin}\)</span> vara väntevärden i de två grupperna.</p>
<p>Låt <span class="math inline">\(\sigma^2_{Hodgkin}\)</span> och <span class="math inline">\(\sigma^2_{NonHodgkin}\)</span> vara varianser i de två grupperna.</p>
<p>Vi har två stickprov <span class="math inline">\((x_1,...,x_{35})\)</span> och <span class="math inline">\((y_1,...,y_{35})\)</span> från gruppenrna med Hodgkin respektive NonHodgkin.</p>
<p>Differensen mellan stickprovsmedelvärden är <span class="math inline">\(\delta = \bar{x}- \bar{y}\)</span> och har följande fördelning</p>
<p><span class="math inline">\(\delta \sim ...\)</span> fyll i beskrivningen!</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 2.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Skatta parametrarna (väntevärde och varians) i fördelningen för differensen <span class="math inline">\(\delta\)</span>.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># skriv din R-kod här</span></span></code><button title="Kopiera till Urklipp" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ta bort detta och skriv ut modellens parametrar i enkel text -->
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uppgift 2.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Är det ett stort problem att antal celler i bloder inte är normalfördelad i de båda grupperna från början? Föreställ dig en situtation där det är ett problem och ge ett förslag på hur man kan åtgärda det?</p>
</div>
</div>
<!-- ta bort detta och skriv dina slutsatser i enkel text -->
<blockquote class="blockquote">
<p>Kör (Render) denna fil till en html (öppna i webbläsare och skriv ut till PDF) eller en PDF och ladda upp din PDF som en laborationsrapport på Canvas. Forsätt sedan med Miniprojekt I under laboration 2!</p>
</blockquote>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopieras!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopieras!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>